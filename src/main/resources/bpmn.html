<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BPMN Editor</title>
    <script src="https://unpkg.com/bpmn-js@9.0.0/dist/bpmn-viewer.production.min.js"></script>
    <script src="https://unpkg.com/bpmn-js@9.0.0/dist/bpmn-modeler.production.min.js"></script>
    <style>
        #canvas {
            height: 600px;
            width: 100%;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>
<div> id="canvas"</div>
<button> id="save-diagram">Save Diagram</button>
<script>
    const bpmnModeler = new BpmnJS({
        container: 'canvas'
    });

    // Load empty BPMN diagram
    const emptyDiagram = '`<?xml version="1.0" encoding="UTF-8"?>\n' +
        '    <bpmn:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n' +
        '        xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL"\n' +
        '        xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"\n' +
        '        xmlns:dc="http://www.omg.org/spec/DD/20100524/DC"\n' +
        '        targetNamespace="http://bpmn.io/schema/bpmn"\n' +
        '        id="Definitions_1">\n' +
        '      <bpmn:process id="Process_1" isExecutable="true">\n' +
        '        <bpmn:startEvent id="StartEvent_1"/>\n' +
        '      </bpmn:process>\n' +
        '      <bpmndi:BPMNDiagram id="BPMNDiagram_1">\n' +
        '        <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_1">\n' +
        '          <bpmndi:BPMNShape id="StartEvent_1_di" bpmnElement="StartEvent_1">\n' +
        '            <dc:Bounds x="179" y="99" width="36" height="36"/>\n' +
        '          </bpmndi:BPMNShape>\n' +
        '        </bpmndi:BPMNPlane>\n' +
        '      </bpmndi:BPMNDiagram>\n' +
        '    </bpmn:definitions>`';

    // Import empty diagram
    bpmnModeler.importXML(emptyDiagram, (err) => {
        if (err) {
            console.error('Failed to load diagram', err);
        } else {
            console.error('BPMN diagram loaded successfully');
        }
    });

    // Save diagram to BPMN XML
    document.getElementById('save-diagram').addEventListener('click', async function() {
        try {
            const { xml } = await bpmnModeler.saveXML({ format: true});
            console.log(xml);

            // Send the BPMN XML to the backend (use Fetch API or Axios)
            fetch('/api/deploy', {
                method: 'POST',
                headers: {
                    'Content Tpye': 'application/xml'
                },
                body: xml
            }).then(response => {
                if (response.ok) {
                    alert('Diagram deployed successfully');
                } else {
                    alert('Failed to deploy diagram');
                }
            })
        }
        catch (err) {
            console.error('Could not save BPMN diagram', err);
        }
    })
</script>

</body>
</html>